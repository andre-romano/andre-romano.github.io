# Workflow de CI para rodar linters e verificações de qualidade de código
name: Integracao Continua

# Dispara o workflow em push ou execução manual.
#     Veja https://docs.github.com/pt/actions/using-workflows/events-that-trigger-workflows para mais opções de eventos
on: [push, workflow_dispatch]

jobs:
  test:
    # Nome do job exibido na interface do GitHub Actions
    name: Test on ${{ matrix.os }} with Python
    # Define o sistema operacional para rodar o job (matriz)
    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
        # Testa em múltiplos sistemas operacionais
        os: [windows-latest]
        # Testa com a versão mais recente do Python 3
        python-version:
          - "3.x"

    steps:
      # Faz o checkout do código-fonte do repositório
      - name: Checkout repository
        uses: actions/checkout@v4

      # Instala a versão do Python definida na matriz
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}

      # Cache das dependências do PDM para acelerar execuções futuras
      - name: Cache PDM dependencies for Python ${{ matrix.python-version }}
        uses: actions/cache@v4
        with:
          path: |
            __pypackages__/
            .venv/
          key: ${{ runner.os }}-pdm-python-${{ matrix.python-version }}-${{ hashFiles('**/pdm.lock') }}
          restore-keys: |
            ${{ runner.os }}-pdm-python-${{ matrix.python-version }}-

      # Instala o PDM, dependências do projeto e checa integridade dos pacotes
      - name: Install Python  ${{ matrix.python-version }} dependencies for ${{ matrix.os }}
        run: |
          python -m pip install --upgrade pip  # Atualiza o pip
          pip install pdm                     # Instala o PDM
          pdm install                        # Instala as dependências do projeto
          pdm run pip check                  # Checa integridade dos pacotes
        shell: bash

      # TODO: Adicione aqui uma etapa para rodar o linter "ruff"
